<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrusTDollar â€“ Official Update</title>

<!-- ğŸ”— Open Graph (Share Preview) -->
<meta property="og:title" content="TrusTDollar â€“ Official Update">
<meta property="og:description" content="Build your income with trust & transparency. Verified daily system announcements.">
<meta property="og:image" content="https://yourdomain.com/photo/share-banner.jpg">
<meta property="og:type" content="website">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, doc, collection, query, orderBy, limit,
  onSnapshot, addDoc, updateDoc, increment,
  getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ğŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyD9Fm_uadnK2k0FMp35j_wbvY9vO3slHx8",
  authDomain: "trustdollar-b632c.firebaseapp.com",
  projectId: "trustdollar-b632c",
  storageBucket: "trustdollar-b632c.appspot.com",
  messagingSenderId: "859933758308",
  appId: "1:859933758308:web:995733db2cc90cbab8e071"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const postRef = doc(db,"posts","announcement");
const commentsRef = collection(postRef,"comments");

const format = n =>
  n>=1e6 ? (n/1e6).toFixed(1)+"M" :
  n>=1e3 ? (n/1e3).toFixed(1)+"K" : n;

/* ğŸ”’ INIT ONCE */
const snap = await getDoc(postRef);
if(!snap.exists()){
  await setDoc(postRef,{
    views:345000,
    likes:12900,
    shares:56000,
    commentsCount:12000
  });
}

/* ğŸ” REALTIME STATS */
onSnapshot(postRef,s=>{
  const d=s.data();
  views.innerText=format(d.views);
  likes.innerText=format(d.likes);
  shares.innerText=format(d.shares);
  cCount.innerText=format(d.commentsCount);
});

/* ğŸ’¬ COMMENTS */
const q=query(commentsRef,orderBy("time","desc"),limit(100));
onSnapshot(q,snap=>{
  comments.innerHTML="";
  snap.forEach(d=>{
    const c=d.data();
    comments.innerHTML+=`
      <div class="comment">
        <div class="avatar">${c.name[0]}</div>
        <div>
          <b>${c.name}</b>
          <p>${c.text}</p>
        </div>
      </div>`;
  });
});

/* ğŸ‘ï¸ AUTO VIEW (SAFE) */
if(!sessionStorage.getItem("viewed")){
  updateDoc(postRef,{views:increment(1)});
  sessionStorage.setItem("viewed","1");
}

window.addEventListener("DOMContentLoaded",()=>{

  /* ğŸ‘ LIKE */
  likeBtn.onclick=()=>{
    if(localStorage.getItem("liked_post")){
      alert("Already liked â¤ï¸");
      return;
    }
    updateDoc(postRef,{likes:increment(1)});
    localStorage.setItem("liked_post","1");
    likeBtn.innerText="â¤ï¸ Liked";
    likeBtn.disabled=true;
    likeBtn.style.opacity="0.6";
  };

  if(localStorage.getItem("liked_post")){
    likeBtn.innerText="â¤ï¸ Liked";
    likeBtn.disabled=true;
    likeBtn.style.opacity="0.6";
  }

  /* ğŸ” SHARE (IMAGE + TEXT) */
  shareBtn.onclick = async () => {
    updateDoc(postRef,{shares:increment(1)});

    const shareText =
`TrusTDollar âœ…

Build your income with trust & transparency.
Verified daily system announcements.

ğŸ‘‰ Join & stay updated`;

    try{
      if(navigator.share){
        await navigator.share({
          title: "TrusTDollar â€“ Official Update",
          text: shareText,
          url: location.href
        });
      }else{
        throw 0;
      }
    }catch{
      await navigator.clipboard.writeText(
        shareText + "\n\n" + location.href
      );
      alert("Link copied ğŸ‘ Ab share karo");
    }
  };

  /* âœï¸ COMMENT */
  sendBtn.onclick=async()=>{
    if(!nameInp.value||!cmt.value){
      alert("Name aur comment dono likho");
      return;
    }
    await addDoc(commentsRef,{
      name:nameInp.value,
      text:cmt.value,
      time:Date.now()
    });
    await updateDoc(postRef,{commentsCount:increment(1)});
    cmt.value="";
  };

});
</script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#f3f4f6;
  font-family:system-ui;
  display:flex;
  justify-content:center;
  padding:10px;
}
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 15px 35px rgba(0,0,0,.08);
}
.card img{
  width:100%;
  height:auto;
  max-height:220px;
  object-fit:cover;
}
.header,.stats,.actions,.add-comment{padding:12px}
.stats{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  font-size:14px;
}
.actions{
  display:flex;
  gap:10px;
}
.actions button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#0284c7;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.comments-box{
  max-height:240px;
  overflow-y:auto;
  padding:12px;
  border-top:1px solid #e5e7eb;
}
.comment{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.avatar{
  width:34px;height:34px;
  background:#0284c7;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
}
.add-comment{
  display:flex;
  flex-direction:column;
  gap:8px;
  border-top:1px solid #e5e7eb;
}
.add-comment input, .add-comment button{
  padding:10px;
  border-radius:8px;
  border:1px solid #d1d5db;
}
.add-comment button{
  background:#0284c7;
  color:#fff;
  border:none;
}
</style>
</head>

<body>
<div class="card">
  <img src="photo/gsaiashksajhsajsss.jpeg">

  <div class="header">
    <b>Official Update</b>
    <p>Verified daily system announcements.</p>
  </div>

  <div class="stats">
    ğŸ‘ï¸ <b id="views"></b>
    ğŸ‘ <b id="likes"></b>
    ğŸ” <b id="shares"></b>
    ğŸ’¬ <b id="cCount"></b>
  </div>

  <div class="actions">
    <button id="likeBtn">ğŸ‘ Like</button>
    <button id="shareBtn">ğŸ” Share</button>
  </div>

  <div class="comments-box" id="comments"></div>

  <div class="add-comment">
    <input id="nameInp" placeholder="Your name">
    <input id="cmt" placeholder="Write comment">
    <button id="sendBtn">Send</button>
  </div>
</div>
</body>
</html>
